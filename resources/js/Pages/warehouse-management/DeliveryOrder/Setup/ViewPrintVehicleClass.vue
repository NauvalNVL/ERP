<template>
  <AppLayout :header="'View & Print Vehicle Classes'">
    <Head title="View & Print Vehicle Classes" />
    <div class="min-h-screen bg-gray-50 py-6 px-4 sm:px-6 lg:px-8">
      <div class="max-w-7xl mx-auto space-y-4">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white shadow-sm rounded-xl border border-indigo-700">
          <div class="flex items-center justify-between px-4 py-3 sm:px-6">
            <div class="flex items-center gap-3">
              <div
                class="h-10 w-10 rounded-full bg-white/20 flex items-center justify-center shadow-inner"
              >
                <i class="fas fa-clipboard-list text-lg"></i>
              </div>
              <div>
                <h1 class="text-lg sm:text-xl font-semibold">
                  View & Print Vehicle Classes
                </h1>
                <p class="text-xs sm:text-sm text-indigo-100">
                  Export vehicle class definitions
                </p>
              </div>
            </div>
            <div class="hidden sm:flex items-center gap-2 text-xs text-indigo-100">
              <i class="fas fa-info-circle"></i>
              <span>Export vehicle classes to PDF.</span>
            </div>
          </div>
        </div>

        <!-- Report Information -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-5">
          <div class="flex items-center mb-4 pb-3 border-b border-gray-100">
            <div class="p-2.5 rounded-lg mr-3 text-white bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 shadow-sm">
              <i class="fas fa-info-circle"></i>
            </div>
            <div>
              <h3 class="text-base sm:text-lg font-semibold text-gray-900">
                Report Information
              </h3>
              <p class="text-xs sm:text-sm text-gray-500">Vehicle class summary data</p>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">Report Date</label>
              <p class="mt-1 text-sm text-gray-900">{{ formatDate(new Date()) }}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Total Records</label>
              <p class="mt-1 text-sm text-gray-900">{{ vehicleClasses.length }}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Generated By</label>
              <p class="mt-1 text-sm text-gray-900">{{ user?.name || "System User" }}</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center gap-2 mt-4">
            <button
              @click="exportToPDF"
              class="px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 shadow-sm hover:from-blue-700 hover:via-indigo-700 hover:to-purple-700 transition-all"
            >
              <i class="fas fa-file-pdf"></i>
              Export PDF
            </button>
          </div>
        </div>

        <!-- Vehicle Classes Report Table -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
          <div class="flex items-center mb-4 pb-3 border-b border-gray-100 px-6 pt-6">
            <div class="p-2.5 rounded-lg mr-3 text-white bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 shadow-sm">
              <i class="fas fa-table"></i>
            </div>
            <div>
              <h3 class="text-base sm:text-lg font-semibold text-gray-900">
                Vehicle Classes Report
              </h3>
              <p class="text-xs sm:text-sm text-gray-500">
                Generated on {{ new Date().toLocaleDateString() }}
              </p>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full border-collapse border border-gray-200">
              <thead class="bg-slate-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider border border-gray-200"
                  >
                    No.
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider border border-gray-200"
                  >
                    Vehicle Class Code
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider border border-gray-200"
                  >
                    Description
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider border border-gray-200"
                  >
                    Created Date
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-indigo-700 uppercase tracking-wider border border-gray-200"
                  >
                    Updated Date
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white">
                <tr v-if="loading" class="animate-pulse">
                  <td colspan="5" class="px-6 py-4 text-center border border-gray-200">
                    <div class="flex items-center justify-center">
                      <svg
                        class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <circle
                          class="opacity-25"
                          cx="12"
                          cy="12"
                          r="10"
                          stroke="currentColor"
                          stroke-width="4"
                        ></circle>
                        <path
                          class="opacity-75"
                          fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                        ></path>
                      </svg>
                      Loading vehicle classes...
                    </div>
                  </td>
                </tr>
                <tr v-else-if="vehicleClasses.length === 0" class="text-center">
                  <td colspan="5" class="px-6 py-8 text-gray-500 border border-gray-200">
                    <div class="flex flex-col items-center">
                      <svg
                        class="w-12 h-12 text-gray-300 mb-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
                        ></path>
                      </svg>
                      <p class="text-lg font-medium">No vehicle classes found</p>
                      <p class="text-sm">
                        No vehicle class data available for reporting.
                      </p>
                    </div>
                  </td>
                </tr>
                <tr
                  v-else
                  v-for="(vehicleClass, index) in vehicleClasses"
                  :key="vehicleClass.id"
                  class="hover:bg-gray-50 transition-colors"
                >
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border border-gray-200">
                    {{ index + 1 }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap border border-gray-200">
                    <div class="text-sm font-medium text-gray-900">
                      {{ vehicleClass.VEHICLE_CLASS_CODE }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap border border-gray-200">
                    <div class="text-sm text-gray-900">
                      {{ vehicleClass.DESCRIPTION }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap border border-gray-200">
                    <div class="text-sm text-gray-900">
                      {{ formatDate(vehicleClass.created_at) }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap border border-gray-200">
                    <div class="text-sm text-gray-900">
                      {{ formatDate(vehicleClass.updated_at) }}
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </AppLayout>
</template>

<script setup>
import { Head } from "@inertiajs/vue3";
import { ref, computed, onMounted } from "vue";
import { useToast } from "@/Composables/useToast";
import AppLayout from "@/Layouts/AppLayout.vue";
import { jsPDF } from "jspdf";
import autoTable from "jspdf-autotable";

const { addToast } = useToast();

// Props
const props = defineProps({
  vehicleClasses: {
    type: Array,
    default: () => [],
  },
  user: {
    type: Object,
    default: () => null,
  },
});

// Reactive data
const loading = ref(false);

// Computed properties
// Removed average calculations as volume and capacity fields no longer exist

// Methods
const formatNumber = (number) => {
  return parseFloat(number).toFixed(2);
};

const formatDate = (date) => {
  return new Date(date).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
  });
};

const exportToPDF = () => {
  try {
    const doc = new jsPDF({ orientation: "landscape" });
    const title = "Vehicle Classes Report";
    doc.setFontSize(14);
    doc.text(title, 14, 14);

    const headers = [
      ["No.", "Vehicle Class Code", "Description", "Created Date", "Updated Date"],
    ];
    const rows = props.vehicleClasses.map((vc, idx) => [
      idx + 1,
      vc.VEHICLE_CLASS_CODE,
      vc.DESCRIPTION,
      formatDate(vc.created_at ?? new Date()),
      formatDate(vc.updated_at ?? new Date()),
    ]);

    autoTable(doc, {
      head: headers,
      body: rows,
      startY: 20,
      styles: { fontSize: 8 },
      headStyles: { fillColor: [79, 70, 229] },
      alternateRowStyles: { fillColor: [245, 245, 245] },
    });

    doc.save(`vehicle-classes_${new Date().toISOString().split("T")[0]}.pdf`);
    addToast("PDF exported successfully", "success");
  } catch (e) {
    addToast("Failed to export PDF", "error");
  }
};

// Lifecycle
onMounted(() => {
  // Component is ready
});
</script>

<style scoped></style>
